<!-- ############################################################ -->
# Алгоритм Raft
.footnote[https://raft.github.io]
## Задача
* Есть несколько серверов.
* Надо достичь консенсуса.
???
Задача сводится к следующему:
- Есть несколько серверов.
- Мы хотим чтобы данные на них были консистентны.
- Бахнем двухфазный коммит и цель достигнута.
---

# Алгоритм Raft
.footnote[https://raft.github.io]
## Задача
* Есть несколько серверов.
* Надо достичь консенсуса.
* В ненадёжной сети.
???
- Но!
- Сеть имеет свойство рваться.
---

# Алгоритм Raft
.footnote[https://raft.github.io]
## Задача
* Есть несколько серверов.
* Надо достичь консенсуса.
* В ненадёжной сети.

## Решение
* Реплицируемый конечный автомат.
* Replicated state machine.
???
- Есть много разных решений, Raft - одно из них.
- Я не буду даже упоминать другие, а буду тупо пиарить рафт.
- Построен с упором на понятность, но мозгу придется потрудиться.
---

<!-- ############################################################ -->
# Реплицируемый конечный автомат
.center[![:scale 1050px](images/raft-1.svg)]
???
- Рафт в качестве решения предлагает...
- Строим терминологический фундамент.
---

<!-- ############################################################ -->
# Персистентное хранилище
.center[![:scale 1050px](images/multiframe.svg#frame1)]
???
- А теперь взгляните на ваши листки.
- Стейт машины нет, есть только журнал.
- Сюда мы будем писать послание, по одной букве в клеточку.
- Содержание потом придумаете сами.
---

<!-- ############################################################ -->
# Лидер, фолловер, кандидат
.center[![:scale 1050px](images/raft-states.svg)]
- *Leader* единственный пишет в журнал + пингует окружающих
- *Follower* пассивен, не отправляет никаких запросов
- *Candidate* проводит голосование
???
- Продолжаем знакомиться с терминологией
---

<!-- ############################################################ -->
# Термы
.center[![:scale 1050px](images/raft-terms.svg)]
---

<!-- ############################################################ -->
<!-- https://css-tricks.com/svg-fragment-identifiers-work/ -->
# Выборы лидера
.center[![:scale 1050px](images/multiframe.svg#frame2)]
???
- Транспорт-агностик
- В рафте это называется RPC
---

<!-- ############################################################ -->
# Голосуйте за меня
.center[![:scale 1050px](images/multiframe.svg#frame3)]
---

<!-- ############################################################ -->
# Обработка запроса
.center[![:scale 1050px](images/multiframe.svg#frame4)]
???
- Голосовать можно 1 раз за терм
- Сначала персистим голос, потом отвечаем на запрос
---

<!-- ############################################################ -->
# Кворум голосов
.center[![:scale 1050px](images/multiframe.svg#frame5)]
---

<!-- ############################################################ -->
# Заполняем raft-журнал
.center[![:scale 1050px](images/multiframe.svg#frame6)]
---

<!-- ############################################################ -->
## Материалы

- Слайды: https://rosik.github.io/2022-fit-m

- Picodata: [@picodataru](https://t.me/picodataru), https://picodata.io/

- Raft: https://raft.github.io/

> In search of Understandable Consensus Algorithm.<br/>
  Diego Ongaro and John Ousterhout.<br/>
  Stanford University.
