# Темы

1. Выборы лидера
2. Репликация лога

# Сценарий

## Ведение

- Какую задачу алгоритм решает — есть распределенная система, но
  падучая. Надо достичь консенсуса.

- Есть несколько алгоритмов, но мы сегодня смотрим только один.

- Ресурсы, которыми узлы располагают (персистентное состояние) и сетевые
  сообщения.

- Активность: распределение raft_id (3-5 минут)

- В рафт журнал имеет право писать только лидер.

- Первая игра. Выборы лидера. (10 минут)

-

## Игра 1. Ознакомительная.

- Выборы не проводим, все голосуют за raft_id 1.
- Задача - реплицировать одну строку.
- Лидер (raft_id 1) записывает в raft log строку.
- Лидер рассылает карточки AppendEntries RPCs сначала с энтрями, потом с коммитом.

## Игра 2. Выборы лидера.

## Игра 3. Split vote.

## Игра. Rollback.

## Игра.
## Игра. Joint quorum.

# Выводы. Какие фичи остались за бортом.
- лог компакшен и снапшоты
- превоуты
-



# Тезисы

- Рафт не защищает от византийских атак.

- Просьба не списывать у соседа. Пожалуйста, не пренебрегайте ролевой игрой. Вы - сервер. Вы можете общаться только записками. Списывать только с той бумажки, которую вы держите в руках. Не торопитесь расстаться с запиской, у нас полно времени.

- Терм - это логические часы. Если вы увидели старый терм - игнорируйте сообщение. Если новый - переходите в состояние фолловера.

- Базовый алгоритм использует всего два типа сообщений:
  * AppendEntries RPCs - инициирует лидер чтоы реплицировать журнал
  * RequestVote RPCs - инициирует кандидат во время выборов
  * Но есть и другие.

- Рафт диссер предполагает, что в логе хранятся некоторые команды к стейт машине. Но мы с вами ей пользоваться не будем. Нам достаточно того, что у всех участников воркшопа журнал выглядит одинаково. не навязывает какой-либо смысл реплицируемым записям, а оставляет это на откуп пользователю. Мы с вами бдем пользваться только

- Лидер трекает максимальный закоммиченный индекс и рассылает его всем фоловерам в AppendEntries RPC. Как только фолловер видит

# Реквизит

- Колода карточек для жеребьевки raft_id
- Шаблоны raft_state
- Шаблоны RequestVoteRPC
- Шаблоны AppendEntriesRPC
- Табличка с состоянием (leader/follower/candidate)
